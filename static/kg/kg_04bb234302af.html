<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Graph: Tell me about policies relating to urban expansion in Brazil</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { margin: 0; padding: 10px; font-family: Arial, sans-serif; }
        .container { width: 100%; height: 1200px; border: 1px solid #ddd; position: relative; }
        .graph { width: 100%; height: 100%; }
        .tooltip { 
            position: absolute; 
            background: rgba(0,0,0,0.8); 
            color: white; 
            padding: 8px; 
            border-radius: 4px; 
            font-size: 12px; 
            pointer-events: none; 
            opacity: 0;
        }
        .query-title { 
            font-size: 14px; 
            font-weight: bold; 
            margin-bottom: 10px; 
            color: #333;
        }
        .node { cursor: pointer; }
        .link { stroke: #999; stroke-opacity: 0.6; stroke-width: 1.5px; }
        .node-label {
            font-size: 10px;
            fill: #333;
            text-anchor: middle;
            pointer-events: none;
            paint-order: stroke;
            stroke: white;
            stroke-width: 3px;
        }
    </style>
</head>
<body>
    <div class="query-title">Knowledge Graph: Tell me about policies relating to urban expansion in Brazil</div>
    <div class="container">
        <svg class="graph" id="kg-graph"></svg>
        <div class="tooltip" id="tooltip"></div>
    </div>
    
    <script>
        // Embedded KG data
        const kgData = {
  "nodes": [
    {
      "id": "Q1207",
      "kind": "Concept",
      "label": "regulatory instrument",
      "description": "Regulatory instruments, or \"authority\" in Hood and Margetts' NATO scheme, set boundaries on behaviour through rules, like emissions disclosure, fossil fuel bans, and spatial planning laws."
    },
    {
      "id": "Q1285",
      "kind": "Concept",
      "label": "ban",
      "description": "A ban is a legal action that prevents the sale or supply of a product or service, or that recalls a product from the market. Examples are bans on SF6, greenwashing, fossil fuel advertisement or single-use plastics."
    },
    {
      "id": "Q1415",
      "kind": "Concept",
      "label": "phase-down",
      "description": "The term \u201cPhase Down\u201d refers to structured reduction in the use of fossil fuels."
    },
    {
      "id": "Q1414",
      "kind": "Concept",
      "label": "phase-out",
      "description": "An approach to catalyse the gradual decline of technologies, substances and practices that compromise environmental sustainability objectives. In climate policy, \"phase out\" ofte refers to the complete cessation of fossil fuel use."
    },
    {
      "id": "Q1171",
      "kind": "Concept",
      "label": "policy instruments",
      "description": "Policy instruments are techniques or tools used by governing authorities to promote certain policies in order to achieve predetermined goals. Put simply, instruments are how a government tries to achieve its goals."
    },
    {
      "id": "Q1283",
      "kind": "Concept",
      "label": "permits and licenses",
      "description": "Environmental permits and licenses regulate business activities that could impact the environment or human health, including climate change."
    },
    {
      "id": "Q1416",
      "kind": "Concept",
      "label": "HFC phase-down",
      "description": ""
    },
    {
      "id": "Q1417",
      "kind": "Concept",
      "label": "fossil fuel phase-out",
      "description": "The complete cessation of fossil fuel use."
    },
    {
      "id": "Q1282",
      "kind": "Concept",
      "label": "zoning and spatial planning",
      "description": "Zoning and spatial planning are both methods for guiding the distribution of people and activities in a space, and are regulatory restriction."
    },
    {
      "id": "Q1413",
      "kind": "Concept",
      "label": "moratorium",
      "description": "Technically means \"temporary ban\" as placing a \u201cmoratorium\u201d implies a willingness to continue studying it and potentially revisit it in the future"
    },
    {
      "id": "Q1284",
      "kind": "Concept",
      "label": "due diligence",
      "description": "The processes through which enterprises can identify, prevent, mitigate and account for how they address their actual and potential adverse impacts. Due diligence is the idea that reasonable precautions should be taken to avoid causing harm to people, the environment, or society. It also involves identifying and mitigating risks before they occur."
    },
    {
      "id": "Q1281",
      "kind": "Concept",
      "label": "codes and standards",
      "description": "Codes and standards are regulatory instruments that specify minimum standards to protect health and safety. This ranges from performance standards, which prescribe outcomes while allowing flexibility to achieve compliance, to the more prescriptive approach of technology-specific standards."
    }
  ],
  "edges": [
    {
      "source": "Q1207",
      "target": "Q1171",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1207",
      "target": "Q1281",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1207",
      "target": "Q1282",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1207",
      "target": "Q1283",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1207",
      "target": "Q1285",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1207",
      "target": "Q1284",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1285",
      "target": "Q1207",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1285",
      "target": "Q1413",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1285",
      "target": "Q1414",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1285",
      "target": "Q1415",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1415",
      "target": "Q1285",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1415",
      "target": "Q1416",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1414",
      "target": "Q1285",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1414",
      "target": "Q1417",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1171",
      "target": "Q1207",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1283",
      "target": "Q1207",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1416",
      "target": "Q1415",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1417",
      "target": "Q1414",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1282",
      "target": "Q1207",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1413",
      "target": "Q1285",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1284",
      "target": "Q1207",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1281",
      "target": "Q1207",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    }
  ],
  "query_concepts": [
    "Q1285"
  ],
  "query_concept_labels": [
    "ban"
  ],
  "total_found": 12,
  "concepts": [
    {
      "id": "Q1207",
      "label": "regulatory instrument"
    },
    {
      "id": "Q1285",
      "label": "ban"
    },
    {
      "id": "Q1415",
      "label": "phase-down"
    },
    {
      "id": "Q1414",
      "label": "phase-out"
    },
    {
      "id": "Q1171",
      "label": "policy instruments"
    },
    {
      "id": "Q1283",
      "label": "permits and licenses"
    },
    {
      "id": "Q1416",
      "label": "HFC phase-down"
    },
    {
      "id": "Q1417",
      "label": "fossil fuel phase-out"
    },
    {
      "id": "Q1282",
      "label": "zoning and spatial planning"
    },
    {
      "id": "Q1413",
      "label": "moratorium"
    },
    {
      "id": "Q1284",
      "label": "due diligence"
    },
    {
      "id": "Q1281",
      "label": "codes and standards"
    }
  ],
  "relationships": [
    {
      "source_id": "Q1207",
      "target_id": "Q1171",
      "source_label": "regulatory instrument",
      "target_label": "policy instruments",
      "relationship_type": "SUBCONCEPT_OF",
      "formatted": "regulatory instrument -> policy instruments (SUBCONCEPT_OF)"
    },
    {
      "source_id": "Q1207",
      "target_id": "Q1281",
      "source_label": "regulatory instrument",
      "target_label": "codes and standards",
      "relationship_type": "HAS_SUBCONCEPT",
      "formatted": "regulatory instrument -> codes and standards (HAS_SUBCONCEPT)"
    },
    {
      "source_id": "Q1207",
      "target_id": "Q1282",
      "source_label": "regulatory instrument",
      "target_label": "zoning and spatial planning",
      "relationship_type": "HAS_SUBCONCEPT",
      "formatted": "regulatory instrument -> zoning and spatial planning (HAS_SUBCONCEPT)"
    },
    {
      "source_id": "Q1207",
      "target_id": "Q1283",
      "source_label": "regulatory instrument",
      "target_label": "permits and licenses",
      "relationship_type": "HAS_SUBCONCEPT",
      "formatted": "regulatory instrument -> permits and licenses (HAS_SUBCONCEPT)"
    },
    {
      "source_id": "Q1207",
      "target_id": "Q1285",
      "source_label": "regulatory instrument",
      "target_label": "ban",
      "relationship_type": "HAS_SUBCONCEPT",
      "formatted": "regulatory instrument -> ban (HAS_SUBCONCEPT)"
    },
    {
      "source_id": "Q1207",
      "target_id": "Q1284",
      "source_label": "regulatory instrument",
      "target_label": "due diligence",
      "relationship_type": "HAS_SUBCONCEPT",
      "formatted": "regulatory instrument -> due diligence (HAS_SUBCONCEPT)"
    },
    {
      "source_id": "Q1285",
      "target_id": "Q1207",
      "source_label": "ban",
      "target_label": "regulatory instrument",
      "relationship_type": "SUBCONCEPT_OF",
      "formatted": "ban -> regulatory instrument (SUBCONCEPT_OF)"
    },
    {
      "source_id": "Q1285",
      "target_id": "Q1413",
      "source_label": "ban",
      "target_label": "moratorium",
      "relationship_type": "HAS_SUBCONCEPT",
      "formatted": "ban -> moratorium (HAS_SUBCONCEPT)"
    },
    {
      "source_id": "Q1285",
      "target_id": "Q1414",
      "source_label": "ban",
      "target_label": "phase-out",
      "relationship_type": "HAS_SUBCONCEPT",
      "formatted": "ban -> phase-out (HAS_SUBCONCEPT)"
    },
    {
      "source_id": "Q1285",
      "target_id": "Q1415",
      "source_label": "ban",
      "target_label": "phase-down",
      "relationship_type": "HAS_SUBCONCEPT",
      "formatted": "ban -> phase-down (HAS_SUBCONCEPT)"
    },
    {
      "source_id": "Q1415",
      "target_id": "Q1285",
      "source_label": "phase-down",
      "target_label": "ban",
      "relationship_type": "SUBCONCEPT_OF",
      "formatted": "phase-down -> ban (SUBCONCEPT_OF)"
    },
    {
      "source_id": "Q1415",
      "target_id": "Q1416",
      "source_label": "phase-down",
      "target_label": "HFC phase-down",
      "relationship_type": "HAS_SUBCONCEPT",
      "formatted": "phase-down -> HFC phase-down (HAS_SUBCONCEPT)"
    },
    {
      "source_id": "Q1414",
      "target_id": "Q1285",
      "source_label": "phase-out",
      "target_label": "ban",
      "relationship_type": "SUBCONCEPT_OF",
      "formatted": "phase-out -> ban (SUBCONCEPT_OF)"
    },
    {
      "source_id": "Q1414",
      "target_id": "Q1417",
      "source_label": "phase-out",
      "target_label": "fossil fuel phase-out",
      "relationship_type": "HAS_SUBCONCEPT",
      "formatted": "phase-out -> fossil fuel phase-out (HAS_SUBCONCEPT)"
    },
    {
      "source_id": "Q1171",
      "target_id": "Q1207",
      "source_label": "policy instruments",
      "target_label": "regulatory instrument",
      "relationship_type": "HAS_SUBCONCEPT",
      "formatted": "policy instruments -> regulatory instrument (HAS_SUBCONCEPT)"
    },
    {
      "source_id": "Q1283",
      "target_id": "Q1207",
      "source_label": "permits and licenses",
      "target_label": "regulatory instrument",
      "relationship_type": "SUBCONCEPT_OF",
      "formatted": "permits and licenses -> regulatory instrument (SUBCONCEPT_OF)"
    },
    {
      "source_id": "Q1416",
      "target_id": "Q1415",
      "source_label": "HFC phase-down",
      "target_label": "phase-down",
      "relationship_type": "SUBCONCEPT_OF",
      "formatted": "HFC phase-down -> phase-down (SUBCONCEPT_OF)"
    },
    {
      "source_id": "Q1417",
      "target_id": "Q1414",
      "source_label": "fossil fuel phase-out",
      "target_label": "phase-out",
      "relationship_type": "SUBCONCEPT_OF",
      "formatted": "fossil fuel phase-out -> phase-out (SUBCONCEPT_OF)"
    },
    {
      "source_id": "Q1282",
      "target_id": "Q1207",
      "source_label": "zoning and spatial planning",
      "target_label": "regulatory instrument",
      "relationship_type": "SUBCONCEPT_OF",
      "formatted": "zoning and spatial planning -> regulatory instrument (SUBCONCEPT_OF)"
    },
    {
      "source_id": "Q1413",
      "target_id": "Q1285",
      "source_label": "moratorium",
      "target_label": "ban",
      "relationship_type": "SUBCONCEPT_OF",
      "formatted": "moratorium -> ban (SUBCONCEPT_OF)"
    },
    {
      "source_id": "Q1284",
      "target_id": "Q1207",
      "source_label": "due diligence",
      "target_label": "regulatory instrument",
      "relationship_type": "SUBCONCEPT_OF",
      "formatted": "due diligence -> regulatory instrument (SUBCONCEPT_OF)"
    },
    {
      "source_id": "Q1281",
      "target_id": "Q1207",
      "source_label": "codes and standards",
      "target_label": "regulatory instrument",
      "relationship_type": "SUBCONCEPT_OF",
      "formatted": "codes and standards -> regulatory instrument (SUBCONCEPT_OF)"
    }
  ],
  "query": "Tell me about policies relating to urban expansion in Brazil",
  "extraction_method": "query_and_mcp_enhanced",
  "query_concepts_count": 1,
  "mcp_concepts_count": 0,
  "total_concepts_found": 1,
  "mcp_concepts": [],
  "links": [
    {
      "source": "Q1207",
      "target": "Q1171",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1207",
      "target": "Q1281",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1207",
      "target": "Q1282",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1207",
      "target": "Q1283",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1207",
      "target": "Q1285",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1207",
      "target": "Q1284",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1285",
      "target": "Q1207",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1285",
      "target": "Q1413",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1285",
      "target": "Q1414",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1285",
      "target": "Q1415",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1415",
      "target": "Q1285",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1415",
      "target": "Q1416",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1414",
      "target": "Q1285",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1414",
      "target": "Q1417",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1171",
      "target": "Q1207",
      "type": "HAS_SUBCONCEPT",
      "weight": 1.0
    },
    {
      "source": "Q1283",
      "target": "Q1207",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1416",
      "target": "Q1415",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1417",
      "target": "Q1414",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1282",
      "target": "Q1207",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1413",
      "target": "Q1285",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1284",
      "target": "Q1207",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    },
    {
      "source": "Q1281",
      "target": "Q1207",
      "type": "SUBCONCEPT_OF",
      "weight": 1.0
    }
  ]
};
        
        // Drawing area
        const width = 1000;   // increased for breathing room
        const height = 1200;  // increased for breathing room
        
        const svg = d3.select("#kg-graph")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("viewBox", `0 0 ${width} ${height}`);
            
        const g = svg.append("g");
        
        // Data
        const nodes = kgData.nodes || [];
        const links = kgData.links || [];

        // Small initial jitter so nodes don't stack at same start pos
        nodes.forEach(n => {
            if (n.x == null || n.y == null) {
                n.x = (width / 2) + (Math.random() - 0.5) * 50;
                n.y = (height / 2) + (Math.random() - 0.5) * 50;
            }
        });

        // Color mapping
        const nodeColors = {
            'Concept': '#1f77b4',
            'Dataset': '#ff7f0e', 
            'Passage': '#2ca02c',
            'Document': '#d62728',
            'Unknown': '#7f7f7f'
        };

        // Reusable node radius (kept in sync with circle r)
        function nodeRadius(d) {
            return Math.max(5, Math.min(15, (d.importance || 1) * 8));
        }

        // Build degree map for smarter link distances
        const degree = {};
        links.forEach(l => {
            const sid = (typeof l.source === 'object') ? l.source.id : l.source;
            const tid = (typeof l.target === 'object') ? l.target.id : l.target;
            degree[sid] = (degree[sid] || 0) + 1;
            degree[tid] = (degree[tid] || 0) + 1;
        });

        // Create links
        const link = g.append("g")
            .selectAll("line")
            .data(links)
            .enter().append("line")
            .attr("class", "link");
        
        // Create nodes
        const node = g.append("g")
            .selectAll("circle")
            .data(nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", d => nodeRadius(d))
            .attr("fill", d => nodeColors[d.type] || nodeColors['Unknown'])
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));
        
        // Add labels (dy uses node radius to keep text just above the circle)
        const label = g.append("g")
            .selectAll("text")
            .data(nodes)
            .enter().append("text")
            .attr("class", "node-label")
            .attr("dy", d => -(nodeRadius(d) + 3))
            .text(d => d.label || d.id);

        // Zoom (we call svg.call(zoom) AFTER label exists so we can toggle it)
        const zoom = d3.zoom()
            .scaleExtent([0.3, 3])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
                const k = event.transform.k;
                // Hide labels when zoomed far out; show as we zoom in
                label.style("display", k < 0.6 ? "none" : null);
                // Optional: scale label font a bit with zoom for readability
                const baseFont = 10;
                label.attr("font-size", `${Math.max(8, Math.min(16, baseFont * Math.sqrt(k)))}px`);
            });
        
        // Physics simulation with collision + stronger repulsion + degree-aware link distance
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links)
                .id(d => d.id)
                .distance(d => {
                    const sid = d.source.id || d.source, tid = d.target.id || d.target;
                    const sdeg = degree[sid] || 0, tdeg = degree[tid] || 0;
                    return 70 + 12 * Math.max(sdeg, tdeg);
                })
                .strength(0.7)
                )

            // Make charge depend on degree: isolates repel less, hubs repel more
            .force("charge", d3.forceManyBody().strength(d => (degree[d.id] || 0) === 0 ? -120 : -400))
            .force("collide", d3.forceCollide().radius(d => nodeRadius(d) + 6).iterations(2))
            .force("x", d3.forceX(width / 2).strength(0.03))   // gentle pull to center
            .force("y", d3.forceY(height / 2).strength(0.03))  // gentle pull to center
            .force("center", d3.forceCenter(width / 2, height / 2))
            .velocityDecay(0.35)
            .alpha(1)
            .alphaDecay(0.02);

        const isolateRadius = Math.min(width, height) * 0.38;
            simulation.force("isolateRadial", d3.forceRadial(
            isolateRadius,
            width / 2,
            height / 2
            ).strength(d => (degree[d.id] || 0) === 0 ? 0.08 : 0));


        // Tooltip
        //const tooltip = d3.select("#tooltip");
        
        //node.on("mouseover", function(event, d) {
        //   tooltip.transition().duration(200).style("opacity", .9);
        //  tooltip.html(`<strong>${d.label || d.id}</strong><br/>Type: ${d.type}<br/>Importance: ${d.importance || 'N/A'}`)
        //        .style("left", (event.pageX + 10) + "px")
        //        .style("top", (event.pageY - 28) + "px");
        //})
        //.on("mouseout", function() {
        //    tooltip.transition().duration(500).style("opacity", 0);
        //});
        
        // Update positions on simulation tick
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);
            
            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);
            
            label
                .attr("x", d => d.x)
                .attr("y", d => d.y)
                .attr("dy", d => -(nodeRadius(d) + 3)); // keep label above node as it moves
        });
        
        // Drag functions
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }
        
        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }
        
        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // Enable zoom after elements (esp. labels) exist
        svg.call(zoom);
    </script>
</body>
</html>